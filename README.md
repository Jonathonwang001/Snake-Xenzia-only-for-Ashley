# Snake-Xenzia-only-for-Ashley
Creating an interesting game only for my love, Ashley. Hope her happy everyday!


<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ë¥™È£üËõáÂ§ßÂÜíÈô©">
    <title>üêç Ë¥™È£üËõáÂ§ßÂÜíÈô© - ÁªàÊûÅÁâà</title>
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' fill='%2332CD32'/><circle cx='35' cy='35' r='5' fill='white'/><circle cx='32' cy='32' r='2' fill='black'/></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            max-width: 400px;
            max-height: 700px;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.1) 0%, transparent 50%);
            touch-action: none;
        }
        
        /* Â§¥ÈÉ®UI */
        #gameUI {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            z-index: 100;
        }
        
        .ui-item {
            text-align: center;
            flex: 1;
        }
        
        .ui-label {
            font-size: 10px;
            opacity: 0.7;
            margin-bottom: 2px;
        }
        
        .ui-value {
            font-size: 16px;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        #score .ui-value { color: #FFD700; }
        #level .ui-value { color: #00BFFF; }
        #lives .ui-value { color: #FF6B6B; }
        
        /* ÊéßÂà∂ÊåâÈíÆ */
        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: grid;
            grid-template-columns: repeat(3, 60px);
            grid-template-rows: repeat(3, 60px);
            gap: 5px;
            z-index: 100;
        }
        
        .control-btn {
            background: linear-gradient(145deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            color: white;
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
            user-select: none;
            -webkit-user-select: none;
        }
        
        .control-btn:active {
            transform: scale(0.9);
            background: linear-gradient(145deg, rgba(255,255,255,0.4), rgba(255,255,255,0.1));
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }
        
        #upBtn { grid-column: 2; grid-row: 1; }
        #leftBtn { grid-column: 1; grid-row: 2; }
        #pauseBtn { grid-column: 2; grid-row: 2; background: linear-gradient(145deg, #FF6B6B, #E55555); }
        #rightBtn { grid-column: 3; grid-row: 2; }
        #downBtn { grid-column: 2; grid-row: 3; }
        
        /* Â±èÂπïÂíåÂºπÁ™ó */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(26,26,46,0.95));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            backdrop-filter: blur(20px);
            padding: 20px;
        }
        
        .screen h1 {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF6B6B);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(255,215,0,0.5);
            text-align: center;
        }
        
        /* ‰øÆÂ§çÊ∏∏ÊàèËØ¥ÊòéÊªöÂä®ÈóÆÈ¢ò */
        .scrollable-content {
            max-height: 60vh;
            overflow-y: auto;
            padding: 10px;
            margin: 10px 0;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            -webkit-overflow-scrolling: touch;
        }
        
        .scrollable-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollable-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }
        
        .scrollable-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.4);
            border-radius: 3px;
        }
        
        .btn {
            background: linear-gradient(145deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(76,175,80,0.4);
            font-family: 'Orbitron', monospace;
            min-width: 150px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76,175,80,0.6);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.danger {
            background: linear-gradient(145deg, #FF6B6B, #E55555);
            box-shadow: 0 5px 15px rgba(255,107,107,0.4);
        }
        
        .btn.secondary {
            background: linear-gradient(145deg, #6C7CE7, #5A6ACF);
            box-shadow: 0 5px 15px rgba(108,124,231,0.4);
        }
        
        .btn.primary {
            background: linear-gradient(145deg, #FFD700, #FFA500);
            color: #1a1a1a;
            box-shadow: 0 5px 15px rgba(255,215,0,0.4);
        }
        
        /* ÂÖ≥Âç°ÈÄâÊã© */
        #levelSelect {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            max-width: 300px;
            margin: 20px 0;
        }
        
        .level-btn {
            aspect-ratio: 1;
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            color: white;
            font-size: 14px;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .level-btn:hover, .level-btn.unlocked:hover {
            border-color: #FFD700;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255,215,0,0.3);
        }
        
        .level-btn.locked {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .level-btn.selected {
            border-color: #FFD700;
            background: linear-gradient(145deg, rgba(255,215,0,0.3), rgba(255,215,0,0.1));
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255,215,0,0.5);
        }
        
        .level-btn.completed::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 5px;
            color: #4CAF50;
            font-size: 16px;
        }
        
        /* ÂÖ≥Âç°‰ø°ÊÅØÊòæÁ§∫ */
        #levelInfo {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        #levelInfo h3 {
            color: #FFD700;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        #levelInfo p {
            opacity: 0.8;
            line-height: 1.4;
            font-size: 0.9rem;
        }
        
        /* ÈÅìÂÖ∑ÊòæÁ§∫ */
        #powerupsUI {
            position: absolute;
            top: 90px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }
        
        .powerup-indicator {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            background: linear-gradient(145deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
            border: 2px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Á≤íÂ≠êÊïàÊûú */
        .particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            animation: particleFloat 2s ease-out forwards;
        }
        
        @keyframes particleFloat {
            0% {
                transform: scale(1) translate(0, 0);
                opacity: 1;
            }
            100% {
                transform: scale(0) translate(var(--dx), var(--dy));
                opacity: 0;
            }
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 480px) {
            #gameContainer {
                border-radius: 0;
                max-width: 100vw;
                max-height: 100vh;
            }
            
            .screen h1 {
                font-size: 2rem;
            }
            
            #controls {
                bottom: 30px;
            }
            
            .control-btn {
                width: 55px;
                height: 55px;
                font-size: 18px;
            }
            
            .scrollable-content {
                max-height: 50vh;
            }
        }
        
        @media (orientation: landscape) and (max-height: 500px) {
            #controls {
                right: 20px;
                bottom: 50%;
                transform: translateY(50%);
                left: auto;
            }
            
            .screen h1 {
                font-size: 1.8rem;
                margin-bottom: 20px;
            }
            
            .scrollable-content {
                max-height: 40vh;
            }
        }
        
        /* Âä†ËΩΩÂä®Áîª */
        .loading {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ÊàêÂ∞±ÈÄöÁü• */
        .achievement {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #FFD700, #FFA500);
            color: #1a1a1a;
            padding: 20px;
            border-radius: 15px;
            font-weight: 700;
            text-align: center;
            z-index: 300;
            animation: achievementPop 3s ease-out forwards;
            box-shadow: 0 10px 30px rgba(255,215,0,0.5);
        }
        
        @keyframes achievementPop {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 1;
            }
            80% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- Ê∏∏ÊàèUI -->
        <div id="gameUI">
            <div id="score" class="ui-item">
                <div class="ui-label">ÂàÜÊï∞</div>
                <div class="ui-value">0</div>
            </div>
            <div id="level" class="ui-item">
                <div class="ui-label">ÂÖ≥Âç°</div>
                <div class="ui-value">1</div>
            </div>
            <div id="lives" class="ui-item">
                <div class="ui-label">ÁîüÂëΩ</div>
                <div class="ui-value">3</div>
            </div>
        </div>
        
        <!-- ÈÅìÂÖ∑ÊåáÁ§∫Âô® -->
        <div id="powerupsUI"></div>
        
        <!-- Ê∏∏ÊàèÁîªÂ∏É -->
        <canvas id="gameCanvas"></canvas>
        
        <!-- ÊéßÂà∂ÊåâÈíÆ -->
        <div id="controls">
            <button class="control-btn" id="upBtn">‚Üë</button>
            <button class="control-btn" id="leftBtn">‚Üê</button>
            <button class="control-btn" id="pauseBtn">‚è∏</button>
            <button class="control-btn" id="rightBtn">‚Üí</button>
            <button class="control-btn" id="downBtn">‚Üì</button>
        </div>
        
        <!-- ÂºÄÂßãÂ±èÂπï -->
        <div id="startScreen" class="screen">
            <h1>üêç Ë¥™È£üËõáÂ§ßÂÜíÈô©</h1>
            <p style="text-align: center; margin-bottom: 20px;">ÂáÜÂ§áÂ•ΩÊåëÊàòÂè≤‰∏äÊúÄÂà∫ÊøÄÁöÑË¥™È£üËõáÊ∏∏Êàè‰∫ÜÂêóÔºü</p>
            <div style="margin: 20px 0; text-align: center; line-height: 1.6;">
                <div>üçé Êî∂ÈõÜÈ£üÁâ©Ëé∑ÂæóÂàÜÊï∞</div>
                <div>üíé ÁâπÊÆäÈÅìÂÖ∑Â∏¶Êù•ÊÉäÂñú</div>
                <div>üèÜ Ëß£ÈîÅÊõ¥Â§öÂÖ≥Âç°</div>
            </div>
            <button class="btn primary" onclick="showLevelSelect()">ÂºÄÂßãÂÜíÈô©</button>
            <button class="btn secondary" onclick="showInstructions()">Ê∏∏ÊàèËØ¥Êòé</button>
        </div>
        
        <!-- ÂÖ≥Âç°ÈÄâÊã© -->
        <div id="levelSelectScreen" class="screen" style="display: none;">
            <h1>ÈÄâÊã©ÂÖ≥Âç°</h1>
            <div id="levelSelect">
                <!-- ÂÖ≥Âç°ÊåâÈíÆÂ∞ÜÈÄöËøáJSÁîüÊàê -->
            </div>
            <div id="levelInfo">
                <h3>ËØ∑ÈÄâÊã©‰∏Ä‰∏™ÂÖ≥Âç°</h3>
                <p>ÁÇπÂáª‰∏äÊñπÂÖ≥Âç°ÊåâÈíÆÊü•ÁúãËØ¶ÊÉÖ</p>
            </div>
            <div>
                <button class="btn primary" id="startLevelBtn" onclick="startSelectedLevel()" style="display: none;">ÂºÄÂßãÊ∏∏Êàè</button>
                <button class="btn secondary" onclick="showStartScreen()">ËøîÂõû</button>
            </div>
        </div>
        
        <!-- Ê∏∏ÊàèËØ¥Êòé -->
        <div id="instructionsScreen" class="screen" style="display: none;">
            <h1>Ê∏∏ÊàèËØ¥Êòé</h1>
            <div class="scrollable-content">
                <div style="text-align: left; line-height: 1.8; font-size: 14px;">
                    <h3 style="color: #FFD700; margin: 15px 0 10px 0;">üéÆ ÊéßÂà∂ÊñπÂºè</h3>
                    <p style="margin-bottom: 15px;">‚Ä¢ ÊªëÂä®Â±èÂπïÊéßÂà∂ËõáÁöÑÁßªÂä®ÊñπÂêë</p>
                    <p style="margin-bottom: 15px;">‚Ä¢ ‰ΩøÁî®Â±èÂπïÂ∫ïÈÉ®ÁöÑÊñπÂêëÈîÆ</p>
                    <p style="margin-bottom: 15px;">‚Ä¢ ÈîÆÁõòÁé©ÂÆ∂ÂèØ‰ΩøÁî® WASD ÊàñÊñπÂêëÈîÆ</p>
                    
                    <h3 style="color: #FFD700; margin: 15px 0 10px 0;">üçé ÊôÆÈÄöÈ£üÁâ©</h3>
                    <p style="margin-bottom: 10px;">‚Ä¢ üçé ÊôÆÈÄöËãπÊûú (+10ÂàÜ)</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ üçá Ëë°ËêÑ (+20ÂàÜÔºå‰∏¥Êó∂Âä†ÈÄü)</p>
                    <p style="margin-bottom: 15px;">‚Ä¢ üçì ËçâËéì (+30ÂàÜÔºå‰∏¥Êó∂ÂáèÈÄü)</p>
                    
                    <h3 style="color: #FFD700; margin: 15px 0 10px 0;">üíé ÁâπÊÆäÈÅìÂÖ∑</h3>
                    <p style="margin-bottom: 10px;">‚Ä¢ üíé ÈíªÁü≥ (+50ÂàÜ)</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ ‚ö° Èó™Áîµ (10ÁßíÁ©øÂ¢ôËÉΩÂäõ)</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ üõ°Ô∏è ÁõæÁâå (5ÁßíÊó†ÊïåÁä∂ÊÄÅ)</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ üåü ÊòüÊòü (15ÁßíÂèåÂÄçÂæóÂàÜ)</p>
                    <p style="margin-bottom: 15px;">‚Ä¢ ‚ùÑÔ∏è ÂÜ∞Âùó (8ÁßíÊó∂Èó¥ÁºìÊÖ¢)</p>
                    
                    <h3 style="color: #FF6B6B; margin: 15px 0 10px 0;">üíÄ Âç±Èô©ÈÅìÂÖ∑</h3>
                    <p style="margin-bottom: 10px;">‚Ä¢ üíÄ È™∑È´Ö (Êâ£Èô§50ÂàÜÂπ∂ÂáèÂ∞ë‰∏ÄÊù°ÁîüÂëΩ)</p>
                    <p style="margin-bottom: 15px;">‚Ä¢ üï≥Ô∏è ÈªëÊ¥û (‰º†ÈÄÅÂà∞ÈöèÊú∫‰ΩçÁΩÆ)</p>
                    
                    <h3 style="color: #FFD700; margin: 15px 0 10px 0;">üèÜ Ê∏∏ÊàèÁõÆÊ†á</h3>
                    <p style="margin-bottom: 10px;">‚Ä¢ ÊØè‰∏™ÂÖ≥Âç°ÈÉΩÊúâÁõÆÊ†áÂàÜÊï∞</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ ËææÂà∞ÁõÆÊ†áÂàÜÊï∞Âç≥ÂèØÈÄöÂÖ≥</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ ÈÅøÂÖçÊíûÂ¢ôÂíåÊíûÂà∞Ëá™Â∑±</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ ÂêàÁêÜÂà©Áî®ÈÅìÂÖ∑Ëé∑Âæó‰ºòÂäø</p>
                    <p style="margin-bottom: 15px;">‚Ä¢ ÊåëÊàòÊõ¥È´òÂàÜÊï∞Ëß£ÈîÅÊàêÂ∞±</p>
                    
                    <h3 style="color: #FFD700; margin: 15px 0 10px 0;">üéØ ÂÖ≥Âç°ÁâπËâ≤</h3>
                    <p style="margin-bottom: 10px;">‚Ä¢ Êñ∞ÊâãÊùëÔºöÂü∫Á°ÄÁé©Ê≥ïÁªÉ‰π†</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ Ê£ÆÊûóËø∑ÂÆ´ÔºöÂ¢ûÂä†Â¢ôÂ£ÅÈöúÁ¢ç</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ ÈÄüÂ∫¶ÁãÇÈ£ôÔºöÊ∏∏ÊàèÈÄüÂ∫¶ÈÄêÊ∏êÂä†Âø´</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ ‰º†ÈÄÅÈó®ÔºöÁ•ûÁßò‰º†ÈÄÅÊåëÊàò</p>
                    <p style="margin-bottom: 15px;">‚Ä¢ BossÂÖ≥Âç°ÔºöÁªàÊûÅÊåëÊàòÁ≠â‰Ω†ÂæÅÊúç</p>
                    
                    <h3 style="color: #4CAF50; margin: 15px 0 10px 0;">üí° Ê∏∏ÊàèÊäÄÂ∑ß</h3>
                    <p style="margin-bottom: 10px;">‚Ä¢ ËßÑÂàíË∑ØÁ∫øÈÅøÂÖçÂõ∞‰ΩèËá™Â∑±</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ ‰ºòÂÖàÊî∂ÈõÜÈ´òÂàÜÈÅìÂÖ∑</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ ÂñÑÁî®ÈÅìÂÖ∑ÊïàÊûúÊó∂Èó¥</p>
                    <p style="margin-bottom: 10px;">‚Ä¢ Ê≥®ÊÑèËßÇÂØüÂç±Èô©ÈÅìÂÖ∑</p>
                    <p style="margin-bottom: 20px;">‚Ä¢ ‰øùÊåÅÂÜ∑ÈùôÔºåÁ®≥‰∏≠Ê±ÇËÉú</p>
                </div>
            </div>
            <button class="btn" onclick="showStartScreen()">ËøîÂõû‰∏ªËèúÂçï</button>
        </div>
        
        <!-- ÊöÇÂÅúÂ±èÂπï -->
        <div id="pauseScreen" class="screen" style="display: none;">
            <h1>Ê∏∏ÊàèÊöÇÂÅú</h1>
            <button class="btn primary" onclick="resumeGame()">ÁªßÁª≠Ê∏∏Êàè</button>
            <button class="btn secondary" onclick="restartLevel()">ÈáçÊñ∞ÂºÄÂßã</button>
            <button class="btn danger" onclick="quitToMenu()">ÈÄÄÂá∫Âà∞ËèúÂçï</button>
        </div>
        
        <!-- Ê∏∏ÊàèÁªìÊùü -->
        <div id="gameOverScreen" class="screen" style="display: none;">
            <h1>Ê∏∏ÊàèÁªìÊùü</h1>
            <div id="gameOverStats" style="margin: 20px 0; text-align: center;">
                <div style="margin: 10px 0;">ÊúÄÁªàÂàÜÊï∞: <span id="finalScore" style="color: #FFD700; font-weight: bold;">0</span></div>
                <div style="margin: 10px 0;">Â≠òÊ¥ªÊó∂Èó¥: <span id="survivalTime" style="color: #87CEEB; font-weight: bold;">0</span>Áßí</div>
                <div style="margin: 10px 0;">ÊúÄÂ§ßÈïøÂ∫¶: <span id="maxLength" style="color: #32CD32; font-weight: bold;">0</span></div>
            </div>
            <button class="btn primary" onclick="restartLevel()">ÈáçÊñ∞ÊåëÊàò</button>
            <button class="btn secondary" onclick="showLevelSelect()">ÈÄâÊã©ÂÖ≥Âç°</button>
            <button class="btn danger" onclick="showStartScreen()">ËøîÂõû‰∏ªËèúÂçï</button>
        </div>
        
        <!-- ÂÖ≥Âç°ÂÆåÊàê -->
        <div id="levelCompleteScreen" class="screen" style="display: none;">
            <h1>üéâ ÂÖ≥Âç°ÂÆåÊàê!</h1>
            <div id="levelCompleteStats" style="margin: 20px 0; text-align: center;">
                <div style="margin: 10px 0;">Ëé∑ÂæóÂàÜÊï∞: <span id="levelScore" style="color: #FFD700; font-weight: bold;">0</span></div>
                <div style="margin: 10px 0;">Êó∂Èó¥Â•ñÂä±: <span id="timeBonus" style="color: #87CEEB; font-weight: bold;">0</span></div>
                <div style="margin: 10px 0;">ÂÆåÁæéÂ•ñÂä±: <span id="perfectBonus" style="color: #32CD32; font-weight: bold;">0</span></div>
            </div>
            <button class="btn primary" onclick="nextLevel()">‰∏ã‰∏ÄÂÖ≥</button>
            <button class="btn secondary" onclick="showLevelSelect()">ÈÄâÊã©ÂÖ≥Âç°</button>
        </div>
    </div>

    <script>
        // Ê∏∏ÊàèÂÖ®Â±ÄÂèòÈáè
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameState = 'menu'; // menu, playing, paused, gameOver, levelComplete
        let selectedLevelId = null;
        
        // Èü≥È¢ë‰∏ä‰∏ãÊñáÂàùÂßãÂåñ
        let audioContext;
        
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // Èü≥ÊïàÁîüÊàêÂô®
        class SoundGenerator {
            static playTone(frequency, duration, type = 'sine', volume = 0.1) {
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            }
            
            static eat() {
                this.playTone(800, 0.1, 'square', 0.3);
                setTimeout(() => this.playTone(1000, 0.1, 'square', 0.2), 50);
            }
            
            static powerup() {
                this.playTone(523, 0.1, 'sine', 0.3);
                setTimeout(() => this.playTone(659, 0.1, 'sine', 0.3), 100);
                setTimeout(() => this.playTone(784, 0.1, 'sine', 0.3), 200);
            }
            
            static death() {
                this.playTone(200, 0.3, 'sawtooth', 0.4);
                setTimeout(() => this.playTone(150, 0.3, 'sawtooth', 0.3), 200);
                setTimeout(() => this.playTone(100, 0.5, 'sawtooth', 0.2), 400);
            }
            
            static levelComplete() {
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        this.playTone(523 + i * 100, 0.2, 'triangle', 0.3);
                    }, i * 100);
                }
            }
            
            static warning() {
                this.playTone(300, 0.1, 'square', 0.2);
            }
        }
        
        // ÁîªÂ∏ÉÂ§ßÂ∞èË∞ÉÊï¥
        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            const rect = container.getBoundingClientRect();
            
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            // Êõ¥Êñ∞Ê∏∏ÊàèÁΩëÊ†º
            if (typeof game !== 'undefined') {
                game.updateGrid();
            }
        }
        
        // Á≤íÂ≠êÁ≥ªÁªü
        class ParticleSystem {
            constructor() {
                this.particles = [];
            }
            
            createExplosion(x, y, color, count = 10) {
                for (let i = 0; i < count; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() - 0.5) * 10,
                        life: 1,
                        decay: 0.02,
                        size: Math.random() * 4 + 2,
                        color: color
                    });
                }
            }
            
            update() {
                this.particles = this.particles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life -= particle.decay;
                    particle.vx *= 0.98;
                    particle.vy *= 0.98;
                    particle.size *= 0.99;
                    
                    return particle.life > 0;
                });
            }
            
            draw(ctx) {
                this.particles.forEach(particle => {
                    ctx.save();
                    ctx.globalAlpha = particle.life;
                    ctx.fillStyle = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                });
            }
        }
        
        // ÂÖ≥Âç°ÂÆö‰πâ
        const levels = [
            {
                id: 1,
                name: "Êñ∞ÊâãÊùë",
                description: "ÁÆÄÂçïÁöÑÂºÄÂßãÔºåÁÜüÊÇâÊ∏∏ÊàèÊìç‰Ωú",
                targetScore: 500,
                speed: 150,
                walls: [],
                specialRules: null,
                bgColor: "#1a1a2e",
                unlocked: true
            },
            {
                id: 2,
                name: "Ê£ÆÊûóËø∑ÂÆ´",
                description: "Â∞èÂøÉÂ¢ôÂ£ÅÈöúÁ¢çÁâ©",
                targetScore: 800,
                speed: 130,
                walls: [
                    {x: 5, y: 5, width: 3, height: 1},
                    {x: 10, y: 8, width: 1, height: 4},
                    {x: 15, y: 3, width: 2, height: 6}
                ],
                specialRules: null,
                bgColor: "#0f3460"
            },
            {
                id: 3,
                name: "ÈÄüÂ∫¶ÁãÇÈ£ô",
                description: "Ê∏∏ÊàèÈÄüÂ∫¶Ë∂äÊù•Ë∂äÂø´",
                targetScore: 1000,
                speed: 100,
                walls: [],
                specialRules: "speedUp",
                bgColor: "#16213e"
            },
            {
                id: 4,
                name: "‰º†ÈÄÅÈó®",
                description: "Á•ûÁßòÁöÑÁ©∫Èó¥‰º†ÈÄÅ",
                targetScore: 1200,
                speed: 140,
                walls: [],
                portals: [
                    {x1: 3, y1: 3, x2: 17, y2: 17},
                    {x1: 17, y1: 3, x2: 3, y2: 17}
                ],
                specialRules: "portals",
                bgColor: "#2d1b69"
            },
            {
                id: 5,
                name: "BossÂÖ≥Âç°",
                description: "ÁªàÊûÅÊåëÊàòÔºåÂæÅÊúç‰∏ÄÂàá",
                targetScore: 2000,
                speed: 120,
                walls: [
                    {x: 0, y: 7, width: 8, height: 1},
                    {x: 12, y: 7, width: 8, height: 1},
                    {x: 7, y: 0, width: 1, height: 6},
                    {x: 7, y: 9, width: 1, height: 6}
                ],
                specialRules: "boss",
                bgColor: "#4a0e2d"
            }
        ];
        
        // ÈÅìÂÖ∑ÂÆö‰πâ
        const powerups = {
            apple: { symbol: 'üçé', points: 10, effect: null, rarity: 0.7 },
            grape: { symbol: 'üçá', points: 20, effect: 'speed', rarity: 0.15 },
            strawberry: { symbol: 'üçì', points: 30, effect: 'slow', rarity: 0.1 },
            diamond: { symbol: 'üíé', points: 50, effect: null, rarity: 0.05 },
            lightning: { symbol: '‚ö°', points: 0, effect: 'wallpass', rarity: 0.03 },
            shield: { symbol: 'üõ°Ô∏è', points: 0, effect: 'invincible', rarity: 0.03 },
            star: { symbol: 'üåü', points: 0, effect: 'doublescore', rarity: 0.02 },
            ice: { symbol: '‚ùÑÔ∏è', points: 0, effect: 'timeslow', rarity: 0.02 },
            skull: { symbol: 'üíÄ', points: -50, effect: 'damage', rarity: 0.02 },
            blackhole: { symbol: 'üï≥Ô∏è', points: 0, effect: 'teleport', rarity: 0.01 }
        };
        
        // ‰∏ªÊ∏∏ÊàèÁ±ª
        class SnakeGame {
            constructor() {
                this.gridSize = 20;
                this.updateGrid();
                this.reset();
                this.particles = new ParticleSystem();
                this.activePowerups = new Map();
                this.gameStartTime = Date.now();
                this.maxLength = 3;
            }
            
            updateGrid() {
                if (canvas.width > 0 && canvas.height > 0) {
                    this.cols = Math.floor(canvas.width / this.gridSize);
                    this.rows = Math.floor(canvas.height / this.gridSize);
                }
            }
            
            reset() {
                this.snake = [
                    {x: Math.floor(this.cols/2), y: Math.floor(this.rows/2)}
                ];
                this.direction = {x: 1, y: 0};
                this.nextDirection = {x: 1, y: 0};
                this.food = null;
                this.score = 0;
                this.level = selectedLevelId || 1;
                this.lives = 3;
                this.speed = 150;
                this.gameStartTime = Date.now();
                this.maxLength = 3;
                this.activePowerups.clear();
                this.generateFood();
                this.updateUI();
            }
            
            generateFood() {
                if (!this.cols || !this.rows) return;
                
                let attempts = 0;
                do {
                    this.food = {
                        x: Math.floor(Math.random() * this.cols),
                        y: Math.floor(Math.random() * this.rows),
                        type: this.getRandomFoodType(),
                        animation: 0
                    };
                    attempts++;
                } while (this.isPositionOccupied(this.food.x, this.food.y) && attempts < 100);
            }
            
            getRandomFoodType() {
                const rand = Math.random();
                let cumulative = 0;
                
                for (const [type, data] of Object.entries(powerups)) {
                    cumulative += data.rarity;
                    if (rand <= cumulative) {
                        return type;
                    }
                }
                return 'apple';
            }
            
            isPositionOccupied(x, y) {
                // Ê£ÄÊü•ËõáË∫´
                for (const segment of this.snake) {
                    if (segment.x === x && segment.y === y) return true;
                }
                
                // Ê£ÄÊü•Â¢ôÂ£Å
                const currentLevel = levels.find(l => l.id === this.level);
                if (currentLevel && currentLevel.walls) {
                    for (const wall of currentLevel.walls) {
                        if (x >= wall.x && x < wall.x + wall.width &&
                            y >= wall.y && y < wall.y + wall.height) {
                            return true;
                        }
                    }
                }
                
                return false;
            }
            
            move() {
                this.direction = {...this.nextDirection};
                const head = {...this.snake[0]};
                head.x += this.direction.x;
                head.y += this.direction.y;
                
                // Â§ÑÁêÜËæπÁïå
                if (!this.activePowerups.has('wallpass')) {
                    if (head.x < 0 || head.x >= this.cols || head.y < 0 || head.y >= this.rows) {
                        this.handleCollision();
                        return;
                    }
                } else {
                    head.x = (head.x + this.cols) % this.cols;
                    head.y = (head.y + this.rows) % this.rows;
                }
                
                // Ê£ÄÊü•Á¢∞Êíû
                if (this.checkCollision(head)) {
                    this.handleCollision();
                    return;
                }
                
                this.snake.unshift(head);
                
                // Ê£ÄÊü•È£üÁâ©
                if (this.food && head.x === this.food.x && head.y === this.food.y) {
                    this.eatFood();
                } else {
                    this.snake.pop();
                }
                
                this.maxLength = Math.max(this.maxLength, this.snake.length);
            }
            
            checkCollision(head) {
                // Ê£ÄÊü•Ëá™Ë∫´Á¢∞Êíû
                if (!this.activePowerups.has('invincible')) {
                    for (let i = 1; i < this.snake.length; i++) {
                        if (this.snake[i].x === head.x && this.snake[i].y === head.y) {
                            return true;
                        }
                    }
                }
                
                // Ê£ÄÊü•Â¢ôÂ£ÅÁ¢∞Êíû
                if (!this.activePowerups.has('wallpass')) {
                    const currentLevel = levels.find(l => l.id === this.level);
                    if (currentLevel && currentLevel.walls) {
                        for (const wall of currentLevel.walls) {
                            if (head.x >= wall.x && head.x < wall.x + wall.width &&
                                head.y >= wall.y && head.y < wall.y + wall.height) {
                                return true;
                            }
                        }
                    }
                }
                
                return false;
            }
            
            handleCollision() {
                if (this.activePowerups.has('invincible')) return;
                
                this.lives--;
                SoundGenerator.death();
                
                // ÂàõÂª∫Ê≠ª‰∫°Á≤íÂ≠êÊïàÊûú
                const head = this.snake[0];
                this.particles.createExplosion(
                    head.x * this.gridSize + this.gridSize/2,
                    head.y * this.gridSize + this.gridSize/2,
                    '#FF6B6B',
                    15
                );
                
                if (this.lives <= 0) {
                    this.gameOver();
                } else {
                    // ÈáçÁΩÆËõáÁöÑ‰ΩçÁΩÆ
                    this.snake = [
                        {x: Math.floor(this.cols/2), y: Math.floor(this.rows/2)}
                    ];
                    this.direction = {x: 1, y: 0};
                    this.nextDirection = {x: 1, y: 0};
                    this.activePowerups.clear();
                }
                
                this.updateUI();
            }
            
            eatFood() {
                if (!this.food) return;
                
                const foodType = powerups[this.food.type];
                const multiplier = this.activePowerups.has('doublescore') ? 2 : 1;
                this.score += Math.max(0, foodType.points * multiplier);
                
                SoundGenerator.eat();
                
                // ÂàõÂª∫ÂêÉÈ£üÁâ©Á≤íÂ≠êÊïàÊûú
                this.particles.createExplosion(
                    this.food.x * this.gridSize + this.gridSize/2,
                    this.food.y * this.gridSize + this.gridSize/2,
                    '#FFD700',
                    8
                );
                
                // Â§ÑÁêÜÁâπÊÆäÊïàÊûú
                this.handlePowerupEffect(this.food.type);
                
                this.generateFood();
                this.updateUI();
                
                // Ê£ÄÊü•ÂÖ≥Âç°ÂÆåÊàêÊù°‰ª∂
                const currentLevel = levels.find(l => l.id === this.level);
                if (this.score >= currentLevel.targetScore) {
                    this.levelComplete();
                }
            }
            
            handlePowerupEffect(type) {
                const effect = powerups[type].effect;
                if (!effect) return;
                
                switch (effect) {
                    case 'speed':
                        this.speed = Math.max(80, this.speed - 20);
                        this.showPowerupIndicator('‚ö°', '#FFD700');
                        setTimeout(() => {
                            this.speed = Math.min(200, this.speed + 20);
                        }, 5000);
                        break;
                        
                    case 'slow':
                        this.speed = Math.min(250, this.speed + 30);
                        this.showPowerupIndicator('üêå', '#87CEEB');
                        setTimeout(() => {
                            this.speed = Math.max(80, this.speed - 30);
                        }, 5000);
                        break;
                        
                    case 'wallpass':
                        this.activePowerups.set('wallpass', Date.now() + 10000);
                        this.showPowerupIndicator('üåü', '#00BFFF');
                        SoundGenerator.powerup();
                        break;
                        
                    case 'invincible':
                        this.activePowerups.set('invincible', Date.now() + 5000);
                        this.showPowerupIndicator('üõ°Ô∏è', '#4CAF50');
                        SoundGenerator.powerup();
                        break;
                        
                    case 'doublescore':
                        this.activePowerups.set('doublescore', Date.now() + 15000);
                        this.showPowerupIndicator('‚≠ê', '#FFD700');
                        SoundGenerator.powerup();
                        break;
                        
                    case 'timeslow':
                        this.activePowerups.set('timeslow', Date.now() + 8000);
                        this.showPowerupIndicator('‚ùÑÔ∏è', '#87CEEB');
                        SoundGenerator.powerup();
                        break;
                        
                    case 'damage':
                        this.lives = Math.max(0, this.lives - 1);
                        this.particles.createExplosion(
                            this.snake[0].x * this.gridSize + this.gridSize/2,
                            this.snake[0].y * this.gridSize + this.gridSize/2,
                            '#FF0000',
                            12
                        );
                        SoundGenerator.warning();
                        if (this.lives <= 0) this.gameOver();
                        break;
                        
                    case 'teleport':
                        const head = this.snake[0];
                        let newX, newY;
                        do {
                            newX = Math.floor(Math.random() * this.cols);
                            newY = Math.floor(Math.random() * this.rows);
                        } while (this.isPositionOccupied(newX, newY));
                        
                        this.particles.createExplosion(
                            head.x * this.gridSize + this.gridSize/2,
                            head.y * this.gridSize + this.gridSize/2,
                            '#800080',
                            10
                        );
                        
                        this.snake[0] = {x: newX, y: newY};
                        
                        this.particles.createExplosion(
                            newX * this.gridSize + this.gridSize/2,
                            newY * this.gridSize + this.gridSize/2,
                            '#800080',
                            10
                        );
                        break;
                }
            }
            
            showPowerupIndicator(emoji, color) {
                const indicator = document.createElement('div');
                indicator.className = 'powerup-indicator';
                indicator.textContent = emoji;
                indicator.style.background = `linear-gradient(145deg, ${color}44, ${color}22)`;
                indicator.style.borderColor = color;
                
                document.getElementById('powerupsUI').appendChild(indicator);
                
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.parentNode.removeChild(indicator);
                    }
                }, 5000);
            }
            
            updatePowerups() {
                const now = Date.now();
                for (const [effect, expireTime] of this.activePowerups.entries()) {
                    if (now > expireTime) {
                        this.activePowerups.delete(effect);
                    }
                }
            }
            
            changeDirection(newDirection) {
                // Èò≤Ê≠¢ÂèçÂêëÁßªÂä®
                if (this.direction.x !== -newDirection.x || this.direction.y !== -newDirection.y) {
                    this.nextDirection = newDirection;
                }
            }
            
            updateUI() {
                document.querySelector('#score .ui-value').textContent = this.score;
                document.querySelector('#level .ui-value').textContent = this.level;
                document.querySelector('#lives .ui-value').textContent = this.lives;
            }
            
            levelComplete() {
                gameState = 'levelComplete';
                SoundGenerator.levelComplete();
                
                const survivalTime = Math.floor((Date.now() - this.gameStartTime) / 1000);
                const timeBonus = Math.max(0, 300 - survivalTime) * 5;
                const perfectBonus = this.lives === 3 ? 200 : 0;
                
                document.getElementById('levelScore').textContent = this.score;
                document.getElementById('timeBonus').textContent = timeBonus;
                document.getElementById('perfectBonus').textContent = perfectBonus;
                
                this.score += timeBonus + perfectBonus;
                
                // Ëß£ÈîÅ‰∏ã‰∏ÄÂÖ≥
                if (this.level < levels.length) {
                    levels[this.level].unlocked = true;
                    localStorage.setItem('snakeGameProgress', JSON.stringify(levels.map(l => ({id: l.id, unlocked: l.unlocked}))));
                }
                
                showScreen('levelCompleteScreen');
                
                // ÊòæÁ§∫ÊàêÂ∞±
                if (perfectBonus > 0) {
                    this.showAchievement('üèÜ ÂÆåÁæéÈÄöÂÖ≥ÔºÅ');
                }
                if (this.maxLength >= 20) {
                    this.showAchievement('üêç Ë∂ÖÈïøËõáÁéãÔºÅ');
                }
            }
            
            gameOver() {
                gameState = 'gameOver';
                
                const survivalTime = Math.floor((Date.now() - this.gameStartTime) / 1000);
                
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('survivalTime').textContent = survivalTime;
                document.getElementById('maxLength').textContent = this.maxLength;
                
                showScreen('gameOverScreen');
                
                // ‰øùÂ≠òÊúÄÈ´òÂàÜ
                const highScore = localStorage.getItem('snakeHighScore') || 0;
                if (this.score > highScore) {
                    localStorage.setItem('snakeHighScore', this.score);
                    this.showAchievement('üéâ Êñ∞Á∫™ÂΩïÔºÅ');
                }
            }
            
            showAchievement(text) {
                const achievement = document.createElement('div');
                achievement.className = 'achievement';
                achievement.textContent = text;
                document.getElementById('gameContainer').appendChild(achievement);
                
                setTimeout(() => {
                    if (achievement.parentNode) {
                        achievement.parentNode.removeChild(achievement);
                    }
                }, 3000);
            }
            
            draw() {
                if (!canvas.width || !canvas.height) return;
                
                // Ê∏ÖÁ©∫ÁîªÂ∏É
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // ÁªòÂà∂ËÉåÊôØ
                const currentLevel = levels.find(l => l.id === this.level);
                if (currentLevel) {
                    const gradient = ctx.createRadialGradient(
                        canvas.width/2, canvas.height/2, 0,
                        canvas.width/2, canvas.height/2, Math.max(canvas.width, canvas.height)/2
                    );
                    gradient.addColorStop(0, currentLevel.bgColor + '44');
                    gradient.addColorStop(1, currentLevel.bgColor + '88');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
                
                // ÁªòÂà∂Â¢ôÂ£Å
                if (currentLevel && currentLevel.walls) {
                    ctx.fillStyle = '#8B4513';
                    currentLevel.walls.forEach(wall => {
                        ctx.fillRect(
                            wall.x * this.gridSize,
                            wall.y * this.gridSize,
                            wall.width * this.gridSize,
                            wall.height * this.gridSize
                        );
                        
                        // Ê∑ªÂä†Èò¥ÂΩ±ÊïàÊûú
                        ctx.fillStyle = 'rgba(0,0,0,0.3)';
                        ctx.fillRect(
                            wall.x * this.gridSize + 2,
                            wall.y * this.gridSize + 2,
                            wall.width * this.gridSize,
                            wall.height * this.gridSize
                        );
                        ctx.fillStyle = '#8B4513';
                    });
                }
                
                // ÁªòÂà∂‰º†ÈÄÅÈó®
                if (currentLevel && currentLevel.portals) {
                    currentLevel.portals.forEach((portal, index) => {
                        const colors = ['#FF00FF', '#00FFFF'];
                        ctx.save();
                        
                        // ÁªòÂà∂‰º†ÈÄÅÈó®Âä®ÁîªÊïàÊûú
                        const time = Date.now() / 1000;
                        const pulse = Math.sin(time * 4) * 0.3 + 0.7;
                        
                        ctx.globalAlpha = pulse;
                        ctx.fillStyle = colors[index % 2];
                        
                        // ÂÖ•Âè£
                        ctx.fillRect(
                            portal.x1 * this.gridSize,
                            portal.y1 * this.gridSize,
                            this.gridSize,
                            this.gridSize
                        );
                        
                        // Âá∫Âè£
                        ctx.fillRect(
                            portal.x2 * this.gridSize,
                            portal.y2 * this.gridSize,
                            this.gridSize,
                            this.gridSize
                        );
                        
                        ctx.restore();
                    });
                }
                
                // ÁªòÂà∂È£üÁâ©
                if (this.food) {
                    const foodData = powerups[this.food.type];
                    const x = this.food.x * this.gridSize;
                    const y = this.food.y * this.gridSize;
                    
                    // È£üÁâ©Âä®Áîª
                    this.food.animation += 0.1;
                    const scale = 1 + Math.sin(this.food.animation) * 0.1;
                    const rotation = this.food.animation * 0.1;
                    
                    ctx.save();
                    ctx.translate(x + this.gridSize/2, y + this.gridSize/2);
                    ctx.scale(scale, scale);
                    ctx.rotate(rotation);
                    
                    // ÁªòÂà∂ÂÖâÊôï
                    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, this.gridSize);
                    gradient.addColorStop(0, 'rgba(255,255,255,0.3)');
                    gradient.addColorStop(1, 'rgba(255,255,255,0)');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(-this.gridSize/2, -this.gridSize/2, this.gridSize, this.gridSize);
                    
                    // ÁªòÂà∂È£üÁâ©emoji
                    ctx.font = `${this.gridSize * 0.8}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(foodData.symbol, 0, 0);
                    
                    ctx.restore();
                }
                
                // ÁªòÂà∂Ëõá
                this.snake.forEach((segment, index) => {
                    const x = segment.x * this.gridSize;
                    const y = segment.y * this.gridSize;
                    
                    ctx.save();
                    
                    if (index === 0) {
                        // ËõáÂ§¥
                        const gradient = ctx.createRadialGradient(
                            x + this.gridSize/2, y + this.gridSize/2, 0,
                            x + this.gridSize/2, y + this.gridSize/2, this.gridSize/2
                        );
                        
                        if (this.activePowerups.has('invincible')) {
                            gradient.addColorStop(0, '#FFD700');
                            gradient.addColorStop(1, '#FFA500');
                        } else {
                            gradient.addColorStop(0, '#32CD32');
                            gradient.addColorStop(1, '#228B22');
                        }
                        
                        ctx.fillStyle = gradient;
                        ctx.fillRect(x + 2, y + 2, this.gridSize - 4, this.gridSize - 4);
                        
                        // ËõáÁúºÁùõ
                        ctx.fillStyle = 'white';
                        const eyeSize = 3;
                        ctx.fillRect(x + 6, y + 4, eyeSize, eyeSize);
                        ctx.fillRect(x + this.gridSize - 9, y + 4, eyeSize, eyeSize);
                        
                        ctx.fillStyle = 'black';
                        ctx.fillRect(x + 7, y + 5, 1, 1);
                        ctx.fillRect(x + this.gridSize - 8, y + 5, 1, 1);
                        
                    } else {
                        // ËõáË∫´
                        const alpha = 1 - (index / this.snake.length) * 0.3;
                        ctx.globalAlpha = alpha;
                        
                        const gradient = ctx.createLinearGradient(x, y, x + this.gridSize, y + this.gridSize);
                        gradient.addColorStop(0, '#90EE90');
                        gradient.addColorStop(1, '#32CD32');
                        
                        ctx.fillStyle = gradient;
                        ctx.fillRect(x + 1, y + 1, this.gridSize - 2, this.gridSize - 2);
                        
                        // ËõáË∫´Á∫πÁêÜ
                        ctx.fillStyle = 'rgba(255,255,255,0.1)';
                        ctx.fillRect(x + 3, y + 3, this.gridSize - 6, 2);
                    }
                    
                    ctx.restore();
                });
                
                // ÁªòÂà∂Á≤íÂ≠êÊïàÊûú
                this.particles.draw(ctx);
                
                // ÁªòÂà∂ÈÅìÂÖ∑ÊïàÊûúÊåáÁ§∫
                if (this.activePowerups.has('invincible')) {
                    ctx.save();
                    ctx.globalAlpha = 0.3;
                    ctx.fillStyle = '#FFD700';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.restore();
                }
                
                if (this.activePowerups.has('timeslow')) {
                    ctx.save();
                    ctx.globalAlpha = 0.2;
                    ctx.fillStyle = '#87CEEB';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.restore();
                }
            }
            
            update() {
                this.updatePowerups();
                this.particles.update();
                
                // Ê†πÊçÆÈÅìÂÖ∑Ë∞ÉÊï¥ÈÄüÂ∫¶
                let currentSpeed = this.speed;
                if (this.activePowerups.has('timeslow')) {
                    currentSpeed *= 2;
                }
                
                // ÁâπÊÆäÂÖ≥Âç°ËßÑÂàô
                const currentLevel = levels.find(l => l.id === this.level);
                if (currentLevel && currentLevel.specialRules === 'speedUp') {
                    currentSpeed = Math.max(80, this.speed - Math.floor(this.score / 100) * 10);
                }
                
                return currentSpeed;
            }
        }
        
        // Ê∏∏ÊàèÂÆû‰æã
        let game;
        let gameLoop;
        let lastTime = 0;
        
        function initGame() {
            game = new SnakeGame();
        }
        
        function startGameLoop() {
            if (gameLoop) clearInterval(gameLoop);
            
            function loop() {
                const now = Date.now();
                const deltaTime = now - lastTime;
                const speed = game.update();
                
                if (deltaTime >= speed) {
                    if (gameState === 'playing') {
                        game.move();
                    }
                    lastTime = now;
                }
                
                game.draw();
                
                if (gameState === 'playing' || gameState === 'paused') {
                    requestAnimationFrame(loop);
                }
            }
            
            requestAnimationFrame(loop);
        }
        
        // Â±èÂπïÁÆ°ÁêÜ
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'flex';
        }
        
        function showStartScreen() {
            gameState = 'menu';
            selectedLevelId = null;
            showScreen('startScreen');
        }
        
        function showLevelSelect() {
            generateLevelButtons();
            showScreen('levelSelectScreen');
            
            // ÈöêËóèÂºÄÂßãÊåâÈíÆÂíåÈáçÁΩÆÂÖ≥Âç°‰ø°ÊÅØ
            document.getElementById('startLevelBtn').style.display = 'none';
            document.getElementById('levelInfo').innerHTML = `
                <h3>ËØ∑ÈÄâÊã©‰∏Ä‰∏™ÂÖ≥Âç°</h3>
                <p>ÁÇπÂáª‰∏äÊñπÂÖ≥Âç°ÊåâÈíÆÊü•ÁúãËØ¶ÊÉÖ</p>
            `;
        }
        
        function showInstructions() {
            showScreen('instructionsScreen');
        }
        
        function selectLevel(levelId) {
            const level = levels.find(l => l.id === levelId);
            if (!level || !level.unlocked) return;
            
            selectedLevelId = levelId;
            
            // Êõ¥Êñ∞ÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-level="${levelId}"]`).classList.add('selected');
            
            // ÊòæÁ§∫ÂÖ≥Âç°‰ø°ÊÅØ
            document.getElementById('levelInfo').innerHTML = `
                <h3>${level.name}</h3>
                <p>${level.description}</p>
                <p style="margin-top: 10px;">ÁõÆÊ†áÂàÜÊï∞: <span style="color: #FFD700;">${level.targetScore}</span></p>
            `;
            
            // ÊòæÁ§∫ÂºÄÂßãÊåâÈíÆ
            document.getElementById('startLevelBtn').style.display = 'inline-block';
        }
        
        function startSelectedLevel() {
            if (!selectedLevelId) return;
            
            initAudio();
            
            if (!game) {
                initGame();
            }
            
            const level = levels.find(l => l.id === selectedLevelId);
            game.level = selectedLevelId;
            game.speed = level.speed;
            game.reset();
            
            gameState = 'playing';
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            
            startGameLoop();
        }
        
        function generateLevelButtons() {
            const container = document.getElementById('levelSelect');
            container.innerHTML = '';
            
            levels.forEach((level, index) => {
                const button = document.createElement('button');
                button.className = `level-btn ${level.unlocked ? 'unlocked' : 'locked'}`;
                button.setAttribute('data-level', level.id);
                button.innerHTML = `
                    <div style="font-size: 18px; margin-bottom: 5px;">${level.id}</div>
                    <div style="font-size: 12px; opacity: 0.8;">${level.name}</div>
                `;
                
                if (level.unlocked) {
                    button.onclick = () => selectLevel(level.id);
                }
                
                // Ê£ÄÊü•ÊòØÂê¶ÂÆåÊàê
                const progress = JSON.parse(localStorage.getItem('snakeGameProgress') || '[]');
                const levelProgress = progress.find(p => p.id === level.id);
                if (levelProgress && levelProgress.completed) {
                    button.classList.add('completed');
                }
                
                container.appendChild(button);
            });
        }
        
        function pauseGame() {
            if (gameState === 'playing') {
                gameState = 'paused';
                showScreen('pauseScreen');
            }
        }
        
        function resumeGame() {
            gameState = 'playing';
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            startGameLoop();
        }
        
        function restartLevel() {
            if (!game) return;
            
            game.reset();
            gameState = 'playing';
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            startGameLoop();
        }
        
        function quitToMenu() {
            gameState = 'menu';
            showStartScreen();
        }
        
        function nextLevel() {
            if (game.level < levels.length) {
                selectedLevelId = game.level + 1;
                startSelectedLevel();
            } else {
                showStartScreen();
            }
        }
        
        // ÊéßÂà∂‰∫ã‰ª∂
        document.getElementById('upBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (game) game.changeDirection({x: 0, y: -1});
        });
        
        document.getElementById('downBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (game) game.changeDirection({x: 0, y: 1});
        });
        
        document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (game) game.changeDirection({x: -1, y: 0});
        });
        
        document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (game) game.changeDirection({x: 1, y: 0});
        });
        
        document.getElementById('pauseBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameState === 'playing') {
                pauseGame();
            } else if (gameState === 'paused') {
                resumeGame();
            }
        });
        
        // ÈîÆÁõòÊéßÂà∂
        document.addEventListener('keydown', (e) => {
            if (gameState !== 'playing' || !game) return;
            
            switch (e.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    e.preventDefault();
                    game.changeDirection({x: 0, y: -1});
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    e.preventDefault();
                    game.changeDirection({x: 0, y: 1});
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    e.preventDefault();
                    game.changeDirection({x: -1, y: 0});
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    e.preventDefault();
                    game.changeDirection({x: 1, y: 0});
                    break;
                case ' ':
                    e.preventDefault();
                    pauseGame();
                    break;
            }
        });
        
        // Ëß¶Êë∏ÊªëÂä®ÊéßÂà∂
        let touchStartX = 0;
        let touchStartY = 0;
        
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }, { passive: false });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });
        
        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            
            if (gameState !== 'playing' || !game) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            const minSwipeDistance = 30;
            
            if (Math.abs(deltaX) > Math.abs(deltaY)) {
                // Ê∞¥Âπ≥ÊªëÂä®
                if (Math.abs(deltaX) > minSwipeDistance) {
                    if (deltaX > 0) {
                        game.changeDirection({x: 1, y: 0}); // Âè≥
                    } else {
                        game.changeDirection({x: -1, y: 0}); // Â∑¶
                    }
                }
            } else {
                // ÂûÇÁõ¥ÊªëÂä®
                if (Math.abs(deltaY) > minSwipeDistance) {
                    if (deltaY > 0) {
                        game.changeDirection({x: 0, y: 1}); // ‰∏ã
                    } else {
                        game.changeDirection({x: 0, y: -1}); // ‰∏ä
                    }
                }
            }
        }, { passive: false });
        
        // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });
        
        // Á™óÂè£Â§ßÂ∞èÊîπÂèòÂ§ÑÁêÜ
        window.addEventListener('resize', () => {
            resizeCanvas();
            if (gameState === 'playing' && game) {
                game.draw();
            }
        });
        
        // È°µÈù¢ÂèØËßÅÊÄßÊîπÂèòÂ§ÑÁêÜ
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && gameState === 'playing') {
                pauseGame();
            }
        });
        
        // Âä†ËΩΩÊ∏∏ÊàèËøõÂ∫¶
        function loadProgress() {
            const progress = JSON.parse(localStorage.getItem('snakeGameProgress') || '[]');
            progress.forEach(p => {
                const level = levels.find(l => l.id === p.id);
                if (level) {
                    level.unlocked = p.unlocked;
                }
            });
        }
        
        // ÂàùÂßãÂåñÊ∏∏Êàè
        window.addEventListener('load', () => {
            resizeCanvas();
            loadProgress();
            
            // ÊòæÁ§∫ÂºÄÂßãÂ±èÂπï
            showStartScreen();
            
            // È¢ÑÂä†ËΩΩÈü≥È¢ë
            setTimeout(initAudio, 1000);
        });
        
        // PWAÊîØÊåÅ
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,');
        }
    </script>
</body>
</html>
